<html>
	<head>
	<script src="fabric.min.js"></script>
	</head>
	<body>
		<canvas height="700" width="1000" id="myCanvas">

		</canvas>
		<buton onclick="start();">
			Start
		</buton>
		<script>

		        var canvas = new fabric.Canvas('myCanvas');
		        //canvas.add(new fabric.Circle({ radius: 30, fill: '#f55', top: 100, left: 100 }));
		        //canvas.selectionColor = 'rgba(0,255,0,0.3)';
		        //canvas.selectionBorderColor = 'red';
		        //canvas.selectionLineWidth = 5

				function makeLine(coords) {
			    return new fabric.Line(coords, {
			      fill: 'red',
			      stroke: 'red',
			      strokeWidth: 2,
			      selectable: false
			    });
  			}
  			var axes = new fabric.Path('M 950 0 L 0 0 L 0 -400 ');
  			axes.set({ fill: 'white', stroke: 'black', opacity: 0.9,strokeWidth: 2 });
  			axes.set({ left: 50, top: 50 });
  			canvas.add(axes);
  			// our values
  			var Y = 50;
  			var maxHeight = 400;
  			var numRect = 10;
  			var totalWidth = 900;
  			var widthr = totalWidth/numRect;
  			var values=[];
  			var i = 0;
  			for(;i < 20;i++) {
  				var rect = new fabric.Rect({
  					left: i*50+55,
  					top: Y+400,
  					fill:'red',
  					width: 40,
  					strokeWidth: 2,
  					height: -Math.floor(Math.random() * maxHeight) + 1
  				});
  				values.push(rect);
  			}
			var k = 0;
  			while ( k<values.length ) {
  				//console.log(values.shift());
  				canvas.add(values[k++]);
  			}
			var i,j;
			var anim = [];
			var valuesback = values.slice();
			/*for(i=0;i<values.length;i++){
				for(j=i+1;j<values.length;j++){
					if(values[i].height<values[j].height){
						//swap(i,j);
						anim.push({'a':i,'b':j});
						var temp1 = values[i];
						values[i] = values[j];
						values[j] = temp1;
						//console.log(i+' '+j);
					}
				}
			}*/
			var j ;
	for(j=1;j<values.length;j++){
		var key = values[j].height;
		var i = j - 1;
		var temp = values[j];
		while((i>-1)&&(values[i].height<key)){
			values[i+1] = values[i];
			anim.push({'a':i+1,'b':i});
			console.log(i+' '+(i+1));
			i--;
		}
		values[i+1] = temp;
	}
			var canAnimate = 1;
			function swap(i,j){
				var temp1 = valuesback[i];
				var temp2 = valuesback[j];
				var x1 = temp1.left;
				var x2 = temp2.left;
				//temp1.left = x2;
				//console.log(x1);
				//temp2.left = x1;
				valuesback[i] = temp2;
				valuesback[j] = temp1;
				//console.log(x2);
				//value[i] = temp2;
				//value[j] = temp1;
				//temp1.animate('height', x2, { onChange: canvas.renderAll.bind(canvas) });
				temp1.set('fill','black');
				temp2.set('fill','blue');
				temp1.animate('left', x2 , {
 					 onChange: canvas.renderAll.bind(canvas),
  					 duration: 500,
  					 onComplete: function(){
  					 	temp1.set('fill','red');
  					 },
  					 //easing: fabric.util.ease.easeOutBounce
				});
				//temp2.animate('height', x1 ,{ onChange: canvas.renderAll.bind(canvas) } );
				temp2.animate('left', x1 , {
 					 onChange: canvas.renderAll.bind(canvas),
  					 duration: 500,
  					 onComplete: function(){
  					 	temp2.set('fill','red');
  					 },
  					 //easing: fabric.util.ease.easeOutBounce
				});


			}
			function doAnimate(animation) {
				if ( animation.length > 0 ) {
					//console.log(animation[0].a+' '+animation[0].b);
					swap( animation[0].a, animation[0].b );
					animation.shift();
					return 1;
				} else {
					return 0;
				}
			}

			function start() {
				var t = setInterval( function(){
				canAnimate = doAnimate( anim );
				if( canAnimate === 0 ) {
					clearInterval(t);
				}
				canvas.renderAll();
			}, 550 );
			}
			canvas.renderAll();
  			//canvas.add(values);
  			//canvas.renderAll();

		</script>
	</body>
</html>
